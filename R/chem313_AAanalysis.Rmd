---
title: "chem313_AAanalysis"
author: "Emily McLaughlin Sta. Maria"
date: "11/6/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

library(tidyverse)

##don't forget to import tidy_AA.csv

```

```{r}

#trying out that calibration curve

cal <- tidy_AA %>%
    filter(type == "CalStd" | type == "CalStd2" | type == "CalStd4") %>%
    select(concentration, mean_abs)
View(cal)

model <- lm(cal$mean_abs ~ cal$concentration)

plot(cal$mean_abs ~ cal$concentration,
     xlab = "Concentrations of Cr (ppm)",
     
     #oh boy is this ppm.
     
     ylab = "Mean Absorbance") +
  abline(model, col = "red") +
  title("Calibration for Cr")

summary(model)
## abs = [(0.0130+/-0.0004)1/ppb] * [Cr in ppb] - 0.002+/-0.002
##mean = 0.0130130
##intercept = -0.0019470

slope <- 0.0130130
intercept <- -0.0019470
slope_error <- 0.0004232
intercept_error <- 0.0021581

Cal_Curve_Eq <- data.frame(slope, intercept, slope_error, intercept_error)
Cal_Curve_Eq
```

```{r}

##method blank

##MB in site is the blanks

##in function(*here) type on input
FixBlank <- function(Site){
  A <- tidy_AA%>%
  filter(site == Site) 
  #first site is column name, second Site is from function(Site)
  Cal_blank <- Cal_Curve_Eq
  m_blank <- Cal_Curve_Eq$slope
  b_blank <- Cal_Curve_Eq$intercept
  y_blank <- A$mean_abs
  x_blank <- (y_blank-b_blank)/m_blank #x_blank = uncorrect conc
  corrected_blank <- x_blank*(A$total_volume/1000)
  average <- mean(corrected_blank)
  sd(corrected_blank)
  blank_95CI <- qt(0.95, df=length(corrected_blank)-1)*sd(corrected_blank)/(sqrt(length(corrected_blank))) ##95% CI's... copy and paste when needed!
  blank_data <- data.frame(site=Site, average, sd(corrected_blank), blank_95CI)
}

AA_MB <- FixBlank("MB")
AA_QC <- FixBlank("QC")

AA_QC
  ##different with sites, need to account for mass of soil

```

```{r}

##this is not blank stuff, despite all the blanks, it's just for the actual data collected... I think

AA_samples <- function(Site){
  A <- tidy_AA%>%
  filter(site == Site) 
  #first site is column name, second Site is from function(Site)
  Cal_blank <- Cal_Curve_Eq
  m_conc <- Cal_Curve_Eq$slope
  b_conc <- Cal_Curve_Eq$intercept
  y_conc <- A$mean_abs
  x_conc <- (y_conc-b_conc)/(m_conc) 
  corrected_conc <- x_conc*(A$total_volume/1000)/((A$mass_of_soil/1000))
  maybe <- corrected_conc - AA_MB$average ##this is just the concentrations - blank = final real life concentration I guess theoretically
  mean(maybe)
  sd(maybe)
  CI <- qt(0.95, df=length(maybe)-1)*sd(maybe)/(sqrt(length(maybe))) ##95% CI's... copy and paste when needed!
 Conc_data <- data.frame(site=Site, mean(maybe), sd(maybe), CI)
}

AA_A <- AA_samples("A")
AA_B <- AA_samples("B")
AA_C <- AA_samples("C")
AA_D <- AA_samples("D")
AA_E <- AA_samples("E")
AA_F <- AA_samples("F")

AA_A
AA_B
AA_C
AA_D
AA_E
AA_F

##units are ppm 



```





```{r}

##So I'm bringing sample_data from ICPMSAnalysis.Rmd into this one, so I can compare them, if I need t-tests or whatnot 

##so upload chem313_ICPMSAnalysis.csv

##Rn imma try to double filter but idk how haha

Average_byMetalSite <- function(Site, Metal){
  C <- ICPMS_data%>%
  filter(site == Site, metal == Metal) 
  #first site is column name, second Site is from function(Site)
  MEAN <- mean(C$conc_blanked/1000) ##dividing by 1000 to convert from ppb to ppm, to match AA data
  SD <- sd(C$conc_blanked/1000)
  CI <- qt(0.95, df=length(C$conc_blanked/1000)-1)*SD/(sqrt(length(C$conc_blanked/1000))) ##95% CI's... copy and paste when needed!
 Conc_data <- data.frame(site=Site, metal=Metal, MEAN, SD, CI)
}

ICPMS_A_As75 <- Average_byMetalSite("A", "As75")
ICPMS_A_Cd111 <- Average_byMetalSite("A", "Cd111")
ICPMS_A_Cd114 <- Average_byMetalSite("A", "Cd114")
ICPMS_A_Cr52 <- Average_byMetalSite("A", "Cr52")
ICPMS_A_Cr53 <- Average_byMetalSite("A", "Cr53")
ICPMS_A_Pb208 <- Average_byMetalSite("A", "Pb208")

ICPMS_B_As75 <- Average_byMetalSite("B", "As75")
ICPMS_B_Cd111 <- Average_byMetalSite("B", "Cd111")
ICPMS_B_Cd114 <- Average_byMetalSite("B", "Cd114")
ICPMS_B_Cr52 <- Average_byMetalSite("B", "Cr52")
ICPMS_B_Cr53 <- Average_byMetalSite("B", "Cr53")
ICPMS_B_Pb208 <- Average_byMetalSite("B", "Pb208")

ICPMS_C_As75 <- Average_byMetalSite("C", "As75")
ICPMS_C_Cd111 <- Average_byMetalSite("C", "Cd111")
ICPMS_C_Cd114 <- Average_byMetalSite("C", "Cd114")
ICPMS_C_Cr52 <- Average_byMetalSite("C", "Cr52")
ICPMS_C_Cr53 <- Average_byMetalSite("C", "Cr53")
ICPMS_C_Pb208 <- Average_byMetalSite("C", "Pb208")

ICPMS_D_As75 <- Average_byMetalSite("D", "As75")
ICPMS_D_Cd111 <- Average_byMetalSite("D", "Cd111")
ICPMS_D_Cd114 <- Average_byMetalSite("D", "Cd114")
ICPMS_D_Cr52 <- Average_byMetalSite("D", "Cr52")
ICPMS_D_Cr53 <- Average_byMetalSite("D", "Cr53")
ICPMS_D_Pb208 <- Average_byMetalSite("D", "Pb208")

ICPMS_E_As75 <- Average_byMetalSite("E", "As75")
ICPMS_E_Cd111 <- Average_byMetalSite("E", "Cd111")
ICPMS_E_Cd114 <- Average_byMetalSite("E", "Cd114")
ICPMS_E_Cr52 <- Average_byMetalSite("E", "Cr52")
ICPMS_E_Cr53 <- Average_byMetalSite("E", "Cr53")
ICPMS_E_Pb208 <- Average_byMetalSite("E", "Pb208")

ICPMS_F_As75 <- Average_byMetalSite("F", "As75")
ICPMS_F_Cd111 <- Average_byMetalSite("F", "Cd111")
ICPMS_F_Cd114 <- Average_byMetalSite("F", "Cd114")
ICPMS_F_Cr52 <- Average_byMetalSite("F", "Cr52")
ICPMS_F_Cr53 <- Average_byMetalSite("F", "Cr53")
ICPMS_F_Pb208 <- Average_byMetalSite("F", "Pb208")


SiteA <- c(ICPMS_A_As75, ICPMS_A_Cd111, ICPMS_A_Cd114, ICPMS_A_Cr52, ICPMS_A_Cr53, ICPMS_A_Pb208)
SiteB <- c(ICPMS_B_As75, ICPMS_B_Cd111, ICPMS_B_Cd114, ICPMS_B_Cr52, ICPMS_B_Cr53, ICPMS_B_Pb208)
SiteC <- c(ICPMS_C_As75, ICPMS_C_Cd111, ICPMS_C_Cd114, ICPMS_C_Cr52, ICPMS_C_Cr53, ICPMS_C_Pb208)
SiteD <- c(ICPMS_D_As75, ICPMS_D_Cd111, ICPMS_D_Cd114, ICPMS_D_Cr52, ICPMS_D_Cr53, ICPMS_D_Pb208)
SiteE <- c(ICPMS_E_As75, ICPMS_E_Cd111, ICPMS_E_Cd114, ICPMS_E_Cr52, ICPMS_E_Cr53, ICPMS_E_Pb208)
SiteF <- c(ICPMS_F_As75, ICPMS_F_Cd111, ICPMS_F_Cd114, ICPMS_F_Cr52, ICPMS_F_Cr53, ICPMS_F_Pb208)

##These values are now in ppm, like AA data

```


